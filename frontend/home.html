<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuito TerÃª Verde</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="header-content">
            <div class="logo" onclick="window.location.href='home.html'" style="cursor:pointer">ğŸŒ¿ Circuito TerÃª Verde
            </div>
            <div class="nav-buttons" id="navButtons"></div>
        </div>
    </header>

    <div class="container">
        <div id="alertContainer"></div>

        <div class="welcome">
            <h1>ğŸŒ¿ Explore TeresÃ³polis</h1>
            <p>Trilhas ecolÃ³gicas e eventos naturais</p>
        </div>

        <div class="card">
            <h2>ğŸ¥¾ Trilhas DisponÃ­veis</h2>
            <div id="trilhas" class="grid"></div>
        </div>

        <div class="card">
            <h2>ğŸª PrÃ³ximos Eventos</h2>
            <div id="eventos" class="grid"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        async function init() {
            const user = await checkAuth();

            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            const nav = document.getElementById('navButtons');
            nav.innerHTML = `
        <button onclick="window.location.href='perfil.html'">ğŸ‘¤ Perfil</button>
        ${user.role === 'admin' ? '<button onclick="window.location.href=\'admin.html\'">âš™ï¸ Admin</button>' : ''}
        <button onclick="logout()">Sair</button>
    `;

            // Mostrar popup APENAS para Super Admin (uma vez por sessÃ£o)
            if (user.superAdmin && !sessionStorage.getItem('superAdminWelcomeShown')) {
                showSuperAdminWelcome(user.nome);
                sessionStorage.setItem('superAdminWelcomeShown', 'true');
            }

            loadTrilhas();
            loadEventos();
        }

        function showSuperAdminWelcome(nome) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
        <div class="modal-super-admin">
            <div class="crown-big">ğŸ‘‘</div>
            <h2>Bem-vindo, ${nome}!</h2>
            <p>VocÃª estÃ¡ logado como <strong>Super Administrador</strong></p>
            
            <div class="privileges">
                <p style="color: #FFD700; font-weight: bold; margin-bottom: 1rem;">Seus PrivilÃ©gios:</p>
                <ul>
                    <li>Controle total sobre trilhas e eventos</li>
                    <li>Gerenciar todos os usuÃ¡rios do sistema</li>
                    <li>Deletar administradores comuns</li>
                    <li>ProteÃ§Ã£o: Super Admins nÃ£o se deletam</li>
                    <li>Acesso a todas as funcionalidades</li>
                </ul>
            </div>
            
            <p style="font-size: 0.9rem; color: #95d5b2;">
                Com grandes poderes vÃªm grandes responsabilidades ğŸ›¡ï¸
            </p>
            
            <button class="btn-close" onclick="this.closest('.modal-overlay').remove()">
                Entendido!
            </button>
        </div>
    `;

            document.body.appendChild(modal);

            // Fechar ao clicar fora
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        function logout() {
            clearAuth();
            window.location.href = 'index.html';
        }

        async function loadTrilhas() {
            const response = await fetch(`${API_URL}/trilhas`);
            const data = await response.json();
            const container = document.getElementById('trilhas');

            if (data.success && data.data.length > 0) {
                container.innerHTML = data.data.map(t => `
                    <div class="item-card">
                        <h3>${t.nome}</h3>
                        <p>${t.descricao}</p>
                        <p><strong>ğŸ“</strong> ${t.localizacao}</p>
                        <p><strong>ğŸ“</strong> ${t.distancia} km | â±ï¸ ${t.duracao}</p>
                        <p><strong>ğŸ‘¥</strong> Capacidade: ${t.capacidadeMaxima} pessoas</p>
                        <span class="badge badge-${t.dificuldade === 'fÃ¡cil' ? 'success' : t.dificuldade === 'moderada' ? 'warning' : 'danger'}">${t.dificuldade}</span>
                        <span class="badge badge-${t.disponivel ? 'success' : 'danger'}">${t.disponivel ? 'Aberta' : 'Fechada'}</span>
                    </div>
                `).join('');
            }
        }

        async function loadEventos() {
            const response = await fetch(`${API_URL}/eventos?ativo=true`);
            const data = await response.json();

            console.log('Eventos:', data.data);

            const container = document.getElementById('eventos');

            if (data.success && data.data.length > 0) {
                container.innerHTML = data.data.map(e => {
                    const inscritos = e.capacidade - (e.vagasDisponiveis || 0);
                    const esgotado = e.vagasDisponiveis === 0;

                    return `
                        <div class="item-card">
                            <h3>${e.titulo}</h3>
                            <p>${e.descricao}</p>
                            <p><strong>ğŸ“</strong> ${e.local}</p>
                            <p><strong>ğŸ“…</strong> ${new Date(e.dataInicio).toLocaleDateString('pt-BR')}</p>
                            <p><strong>ğŸ‘¥</strong> ${inscritos}/${e.capacidade} inscritos</p>
                            <span class="badge badge-info">${e.tipo}</span>
                            <span class="badge badge-${esgotado ? 'danger' : 'success'}">${esgotado ? 'Esgotado' : 'Vagas disponÃ­veis'}</span>
                        </div>
                    `;
                }).join('');
            }
        }

        init();
    </script>
</body>

</html>